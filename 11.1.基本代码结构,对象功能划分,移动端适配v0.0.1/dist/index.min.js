var __extends=this&&this.__extends||function(){var s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;for(var s=Array(t),a=0,e=0;e<i;e++)for(var n=arguments[e],o=0,h=n.length;o<h;o++,a++)s[a]=n[o];return s};window.addEventListener("load",function(){var t=document.querySelector("#myCanvas"),e=t.getContext("2d");t.width=1080,t.height=720;function h(t,e){return Math.random()*(e-t)+t}var i=(s.prototype.previewGame=function(){this.background=new c(this),this.player=new T(this),this.InputListener.inputs=[],this.enemys=[],this.score=0,this.scenceMoveSpeed=-.5,this.scenceMoveSpeedFactor=1,this.addEnemyInterval=500,this.gameStatus="Preview"},s.prototype.initGame=function(){this.background=new c(this),this.player=new T(this),this.InputListener.inputs=[],this.enemys=[],this.score=0,this.scenceMoveSpeed=-.5,this.scenceMoveSpeedFactor=1,this.addEnemyInterval=1500,this.gameStatus="Init"},s.prototype.gameOver=function(){this.scenceMoveSpeedFactor=0,this.player.action_ko(),this.gameStatus="GameOver"},s.prototype.userInputHandler=function(){this.InputListener.inputs.includes(k.StartGame)?"Preview"==this.gameStatus?(this.initGame(),this.gameStatus="Running"):"Stop"==this.gameStatus?this.gameStatus="Running":"GameOver"==this.gameStatus&&this.previewGame():this.InputListener.inputs.includes(k.StopGame)&&"Running"==this.gameStatus&&(this.gameStatus="Stop")},s.prototype.playerInputHandler=function(t){0==this.InputListener.inputs.length?(this.player.action_default(),this.scenceMoveSpeedFactor=1):this.InputListener.inputs.includes(x.GoAhead)?(this.player.action_ahead(),this.scenceMoveSpeedFactor=2):this.InputListener.inputs.includes(x.Back)?(this.player.action_back(),this.scenceMoveSpeedFactor=-.8):this.InputListener.inputs.includes(x.Down)&&(this.player.action_sit(),this.scenceMoveSpeedFactor=0),this.InputListener.inputs.includes(x.Up)&&(this.player.action_jump(),this.scenceMoveSpeedFactor=1.25)},s.prototype.cllisionCheackerHandler=function(){for(var t=0;t<this.enemys.length;t++)if(this.enemys[t].isCollision(this.player))return!0;return!1},s.prototype.scenceMoveHandler=function(e){var i=this.scenceMoveSpeed*this.scenceMoveSpeedFactor;this.background.backgroundMoveSpeedX=i,this.enemys.forEach(function(t){return t.posX+=i*e})},s.prototype.scoreUpdateHandler=function(t){this.score+=-1*this.scenceMoveSpeed*this.scenceMoveSpeedFactor*t,this.displayScore=(this.score/100).toFixed(0)+"m"},s.prototype.update=function(t){this.userInputHandler(),"Preview"!=this.gameStatus&&"Running"!=this.gameStatus||(this.playerInputHandler(t),this.scoreUpdateHandler(t),"Running"==this.gameStatus&&this.difficultyAddHandler(t),"Running"==this.gameStatus&&this.cllisionCheackerHandler()&&this.gameOver()),this.EnemyHandler(t),this.scenceMoveHandler(t)},s.prototype.animate=function(e){this.Context2D.clearRect(0,0,this.CANVAS_WIDTH,this.CANVAS_HEIGHT),this.background.refresh(e),__spreadArrays(this.enemys,[this.player]).sort(function(t,e){return t.posY-e.posY}).forEach(function(t){return t.refresh(e)})},s.prototype.refresh=function(t){this.update(t),this.animate(t),this.GameStatusDisplayHandler()},s.prototype.difficultyAddHandler=function(t){this.addEnemyInterval>this.difficultyMaxAddEnemyInterval&&(this.addEnemyInterval+=this.difficultyAddSpeed*t)},s.prototype.EnemyHandler=function(t){if(this.addEnemyTimer+=t,this.addEnemyTimer>this.addEnemyInterval)switch(this.addEnemyTimer=0,Math.floor(h(0,3))){case 0:this.enemys.push(new _(this));break;case 1:this.enemys.push(new f(this));break;case 2:this.enemys.push(new F(this))}this.enemys=this.enemys.filter(function(t){return t.isAlive()})},s.prototype.GameStatusDisplayHandler=function(){this.Context2D.save(),this.Context2D.font="40px Impact","Preview"==this.gameStatus||"Init"==this.gameStatus?(this.Context2D.textAlign="center",this.Context2D.fillStyle="white",this.Context2D.fillText("Press Enter To Start Game...",this.CANVAS_WIDTH/2,this.CANVAS_HEIGHT/2),this.Context2D.fillStyle="black",this.Context2D.fillText("Press Enter To Start Game...",this.CANVAS_WIDTH/2+2,this.CANVAS_HEIGHT/2+2)):"Running"==this.gameStatus?(this.Context2D.textAlign="left",this.Context2D.fillStyle="white",this.Context2D.fillText("Score: "+this.displayScore,5,40),this.Context2D.fillStyle="black",this.Context2D.fillText("Score: "+this.displayScore,7,42)):"Stop"==this.gameStatus?(this.Context2D.textAlign="center",this.Context2D.fillStyle="white",this.Context2D.fillText("Press Enter To Continue...",this.CANVAS_WIDTH/2,this.CANVAS_HEIGHT/2),this.Context2D.fillStyle="black",this.Context2D.fillText("Press Enter To Continue...",this.CANVAS_WIDTH/2+2,this.CANVAS_HEIGHT/2+2)):"GameOver"==this.gameStatus&&(this.Context2D.textAlign="center",this.Context2D.fillStyle="white",this.Context2D.fillText("Game Over Your Score Is: "+this.displayScore,this.CANVAS_WIDTH/2,this.CANVAS_HEIGHT/2),this.Context2D.fillStyle="black",this.Context2D.fillText("Game Over Your Score Is: "+this.displayScore,this.CANVAS_WIDTH/2+2,this.CANVAS_HEIGHT/2+2)),this.Context2D.restore()},s);function s(t,e,i,s){this.gameStatus="Preview",this.scenceMoveSpeed=-.5,this.scenceMoveSpeedFactor=1,this.enemys=[],this.addEnemyTimer=0,this.addEnemyInterval=1500,this.difficultyMaxAddEnemyInterval=500,this.difficultyAddSpeed=-1e-4,this.score=0,this.CanvasDOM=t,this.Context2D=e,this.CANVAS_WIDTH=i,this.CANVAS_HEIGHT=s,this.InputListener=new N(this.CanvasDOM),this.previewGame()}var a=(n.prototype.update=function(t){this.pos1_X+=this.layerMoveSpeedX*this.layerMoveSpeedFactor*t,this.pos2_X+=this.layerMoveSpeedX*this.layerMoveSpeedFactor*t,this.layerMoveSpeedX<0&&this.pos1_X+this.imgWidth<=0&&(this.pos1_X=this.pos2_X+this.imgWidth),this.layerMoveSpeedX<0&&this.pos2_X+this.imgWidth<=0&&(this.pos2_X=this.pos1_X+this.imgWidth),0<this.layerMoveSpeedX&&0<=this.pos1_X&&(this.pos2_X=this.pos1_X-this.imgWidth),0<this.layerMoveSpeedX&&0<=this.pos2_X&&(this.pos1_X=this.pos2_X-this.imgWidth)},n.prototype.draw=function(t){this.game.Context2D.drawImage(this.img,0,0,this.imgWidth,this.imgHeight,this.pos1_X,this.pox1_Y,this.imgWidth,this.game.CANVAS_HEIGHT),this.game.Context2D.drawImage(this.img,0,0,this.imgWidth,this.imgHeight,this.pos2_X,this.pox2_Y,this.imgWidth,this.game.CANVAS_HEIGHT)},n.prototype.refresh=function(t){this.update(t),this.draw(t)},n);function n(t,e,i,s,a){this.layerMoveSpeedX=0,this.layerMoveSpeedFactor=1,this.game=t,this.img=new Image,this.img.src=e,this.imgWidth=i,this.imgHeight=s,this.layerMoveSpeedFactor=a,this.pos1_X=0,this.pox1_Y=0,this.pos2_X=this.imgWidth,this.pox2_Y=0}var o=(r.prototype.update=function(e){this.layers.forEach(function(t){return t.update(e)})},r.prototype.draw=function(e){this.layers.forEach(function(t){return t.draw(e)})},r.prototype.refresh=function(t){this.update(t),this.draw(t)},Object.defineProperty(r.prototype,"backgroundMoveSpeedX",{get:function(){return this._backgroundMoveSpeedX},set:function(e){this._backgroundMoveSpeedX!=e&&(this.layers.forEach(function(t){return t.layerMoveSpeedX=e}),this._backgroundMoveSpeedX=e)},enumerable:!1,configurable:!0}),r);function r(){this._backgroundMoveSpeedX=0,this.layers=[]}var p,c=(__extends(m,p=o),m);function m(t){var e=p.call(this)||this;return e.layers.push(new a(t,"./imgs/trees.png",2400,720,1)),e.backgroundMoveSpeedX=-.5,e}var d=(u.prototype.update=function(t){},u.prototype.animate=function(t){1==this.stopAnimateAtLastFlag&&this.isLastAnimateFrame()||(this.animateFrameIndexX=Math.floor(this.animateFrameCount++/this.animateFrameStage*this.animateFrameStageFactor)%this.animateFramesTotal[this.animateFrameIndexY]),this.game.Context2D.drawImage(this.img,this.animateFrameIndexX*this.imgFrameWidth,this.animateFrameIndexY*this.imgFrameHeight,this.imgFrameWidth,this.imgFrameHeight,this.posX,this.posY,this.drawWidth,this.drawHeight)},u.prototype.refresh=function(t){this.update(t),this.animate(t)},u.prototype.changeAnimateByName=function(t){if(!this.animateNameIndexMap.includes(t))throw new Error("animateName:'"+t+"' is not exist.");this.animateFrameIndexY=this.animateNameIndexMap.indexOf(t)},u.prototype.isLastAnimateFrame=function(){return this.animateFrameIndexX==this.animateFramesTotal[this.animateFrameIndexY]-1},u.prototype.requestAnimateFrameAtFirstFrame=function(){this.animateFrameCount=0},u.prototype.requestStopAnimateFrameAtLastFrame=function(){this.stopAnimateAtLastFlag=!0},u);function u(t,e,i,s,a,n,o){this.posX=0,this.posY=0,this.animateNameIndexMap=["idle"],this.animateFrameIndexX=0,this.animateFrameIndexY=0,this.animateFrameCount=0,this.animateFrameStage=3,this.animateFrameStageFactor=1,this.stopAnimateAtLastFlag=!1,this.game=t,this.img=new Image,this.img.src=e,this.animateFramesTotal=n,this.animateNameIndexMap=o,this.imgFrameWidth=i,this.imgFrameHeight=s,this.drawWidth=this.imgFrameWidth*a,this.drawHeight=this.imgFrameHeight*a,this.animateFrameStage=Math.floor(h(3,8))}var l,g=(__extends(S,l=d),S.prototype.collisionCheckUpdate=function(){this.collisionCheckPosX=this.posX+this.drawWidth/2,this.collisionCheckPosY=this.posY+this.drawHeight/2,this.collisionCheckRadius=Math.min(this.drawWidth,this.drawHeight)/2*.75},S.prototype.isCollision=function(t){this.collisionCheckUpdate(),t.collisionCheckUpdate();var e=this.collisionCheckPosX-t.collisionCheckPosX,i=this.collisionCheckPosY-t.collisionCheckPosY;return Math.sqrt(e*e+i*i)<this.collisionCheckRadius+t.collisionCheckRadius},S.prototype.animate=function(t){l.prototype.animate.call(this,t)},S);function S(){var t=null!==l&&l.apply(this,arguments)||this;return t.moveSpeedX=0,t.moveSpeedY=0,t.aliveFlag=!0,t}var y,f=(__extends(v,y=g),v.prototype.isAlive=function(){return 0<this.posX+this.drawWidth},v.prototype.move=function(t){this.posX-=this.moveSpeedX*t},v.prototype.update=function(t){this.move(t)},v);function v(t){var e=y.call(this,t,"./imgs/Worm.png",229,171,.5,[6],["idle"])||this;return e.posX=e.game.CANVAS_WIDTH,e.posY=e.game.CANVAS_HEIGHT-e.drawHeight,e.moveSpeedX=h(.1,.2),e}var A,_=(__extends(C,A=g),C.prototype.isAlive=function(){return 0<this.posX+this.drawWidth},C.prototype.move=function(t){this.posX-=this.moveSpeedX*t},C.prototype.shake=function(t){this.posY+=this.shakeGapRadius*Math.sin(this.shakeAngle),this.shakeAngle+=this.shakeDeltaAngle*t},C.prototype.update=function(t){this.move(t),this.shake(t)},C.prototype.animate=function(t){this.game.Context2D.save(),this.game.Context2D.globalAlpha=this.alpha,A.prototype.animate.call(this,t),this.game.Context2D.restore()},C);function C(t){var e=A.call(this,t,"./imgs/Ghost.png",261,209,.5,[6],["idle"])||this;return e.shakeAngle=0,e.posX=e.game.CANVAS_WIDTH,e.posY=.5*h(0,e.game.CANVAS_HEIGHT-e.drawHeight),e.moveSpeedX=h(.2,.3),e.alpha=h(.2,.5),e.shakeAngle=h(Math.asin(-1),Math.asin(1)),e.shakeDeltaAngle=h(Math.asin(.001),Math.asin(.003)),e.shakeGapRadius=h(2,5),e}var w,F=(__extends(H,w=g),H.prototype.isAlive=function(){return this.shakeAngle<=Math.PI},H.prototype.shake=function(t){this.posY=this.shakePosY+this.shakeGapRadius*Math.sin(this.shakeAngle),this.shakeAngle+=this.shakeDeltaAngle*t},H.prototype.move=function(t){this.shake(t)},H.prototype.update=function(t){this.move(t)},H.prototype.animate=function(t){this.game.Context2D.beginPath(),this.game.Context2D.moveTo(this.posX+this.drawWidth/2,0),this.game.Context2D.lineTo(this.posX+this.drawWidth/2,this.posY),this.game.Context2D.stroke(),w.prototype.animate.call(this,t)},H);function H(t){var e=w.call(this,t,"./imgs/Spider.png",310,175,.5,[6],["idle"])||this;return e.shakeAngle=0,e.posX=h(0,e.game.CANVAS_WIDTH-e.drawWidth),e.posY=-e.drawHeight,e.shakePosY=e.posY,e.shakeAngle=0,e.shakeDeltaAngle=h(Math.asin(5e-4),Math.asin(.001)),e.shakeGapRadius=h(e.game.CANVAS_HEIGHT/4,e.game.CANVAS_HEIGHT),e}var X,x,I,k,D,M,T=(__extends(G,X=g),G.prototype.inSky=function(){return this.posY<=this.game.CANVAS_HEIGHT-this.drawHeight-this.drawHeight/4},G.prototype.action_default=function(){this.moveSpeedX=0*this.actionMoveSpeedX,this.animateFrameStageFactor=1,this.changeAnimateByName("run")},G.prototype.action_ahead=function(){this.moveSpeedX=+this.actionMoveSpeedX,this.animateFrameStageFactor=1.5,this.changeAnimateByName("run")},G.prototype.action_back=function(){this.moveSpeedX=-this.actionMoveSpeedX,this.animateFrameStageFactor=1,this.changeAnimateByName("run")},G.prototype.action_idle=function(){this.moveSpeedX=0,this.moveSpeedY=0,this.animateFrameStageFactor=1,this.changeAnimateByName("idle")},G.prototype.action_sit=function(){this.moveSpeedX=0,this.moveSpeedY=0,this.animateFrameStageFactor=1,this.changeAnimateByName("sit")},G.prototype.action_roll=function(){this.moveSpeedX=-this.actionMoveSpeedX,this.animateFrameStageFactor=1,this.changeAnimateByName("roll")},G.prototype.action_dizzy=function(){this.moveSpeedX=0,this.moveSpeedY=0,this.animateFrameStageFactor=1,this.changeAnimateByName("dizzy")},G.prototype.action_bite=function(){this.moveSpeedX=0,this.moveSpeedY=0,this.animateFrameStageFactor=1,this.changeAnimateByName("bite")},G.prototype.action_ko=function(){this.moveSpeedX=0,this.moveSpeedY=0,this.aliveFlag=!1,this.animateFrameStageFactor=2,this.changeAnimateByName("ko"),this.requestAnimateFrameAtFirstFrame(),this.requestStopAnimateFrameAtLastFrame()},G.prototype.action_gethit=function(){this.moveSpeedX=0,this.moveSpeedY=0,this.changeAnimateByName("gethit")},G.prototype.action_jump=function(){this.inSky()||(this.changeAnimateByName("jump"),this.jumpSpeed=this.jumpSpeedConst)},G.prototype.gravity=function(){this.inSky()&&(this.jumpSpeed+=this.jumpWeight,this.jumpSpeed<0&&this.isAlive()&&this.changeAnimateByName("jump"),0<this.jumpSpeed&&this.isAlive()&&this.changeAnimateByName("fall"))},G.prototype.dragBack=function(){this.posX<0?this.posX=0:this.posX+this.drawWidth>this.game.CANVAS_WIDTH&&(this.posX=this.game.CANVAS_WIDTH-this.drawWidth),this.posY<0?this.posY=0:this.posY+this.drawHeight>this.game.CANVAS_HEIGHT&&(this.posY=this.game.CANVAS_HEIGHT-this.drawHeight)},G.prototype.move=function(t){this.posX+=this.moveSpeedX*t,this.posY+=this.moveSpeedY*t+this.jumpSpeed*t},G.prototype.update=function(t){this.move(t),this.gravity(),this.dragBack()},G.prototype.isAlive=function(){return this.aliveFlag},G);function G(t){var e=X.call(this,t,"./imgs/shadow_dog.png",575,523,.4,[7,7,7,9,11,5,7,7,12,4],["idle","jump","fall","run","dizzy","sit","roll","bite","ko","gethit"])||this;return e.animateFrameStage=4,e.posX=h(0,e.drawWidth),e.posY=e.game.CANVAS_HEIGHT-e.drawHeight-e.drawHeight/4,e.actionMoveSpeedX=h(.3,.3),e.actionMoveSpeedY=h(.3,.3),e.jumpWeight=.08,e.jumpSpeed=0,e.jumpSpeedConst=-h(1.5,1.5),e}(I=x=x||{}).GoAhead="GoAhead",I.Back="Back",I.Up="Up",I.Down="Down",I.Space="Space",(D=k=k||{}).StartGame="StartGame",D.StopGame="StopGame",(M=M||{}).FullScreem="FullScreem";var E={ArrowRight:x.GoAhead,ArrowLeft:x.Back,ArrowUp:x.Up,ArrowDown:x.Down,d:x.GoAhead,a:x.Back,w:x.Up,s:x.Down,D:x.GoAhead,A:x.Back,W:x.Up,S:x.Down," ":x.Space,Enter:k.StartGame,Escape:k.StopGame,f:M.FullScreem,F:M.FullScreem},N=(Y.prototype.listen=function(){var s,a,n=this;window.addEventListener("keydown",function(t){var e=E[t.key];null==e||n.inputs.includes(e)||n.inputs.push(e)}),window.addEventListener("keypress",function(){n.inputs.includes(M.FullScreem)&&n.CanvasDOM.requestFullscreen({navigationUI:"hide"}).catch(function(t){return console.log(t)})}),window.addEventListener("keyup",function(t){var e,i=E[t.key];null!=i&&n.inputs.includes(i)&&(e=n.inputs.findIndex(function(t){return t==i}),n.inputs.splice(e,1))}),window.addEventListener("touchstart",function(t){t.preventDefault(),t.stopPropagation(),s=t.changedTouches[0],1==t.touches.length?n.inputs.push(k.StartGame):2==t.touches.length&&n.CanvasDOM.requestFullscreen({navigationUI:"hide"}).catch(function(t){return alert(t)})}),window.addEventListener("touchmove",function(t){t.preventDefault(),t.stopPropagation();var e=(a=t.changedTouches[0]).clientY-s.clientY,i=a.clientX-s.clientX;50<i?n.inputs.push(x.GoAhead):i<-50&&n.inputs.push(x.Back),e<-50?n.inputs.push(x.Up):50<e&&n.inputs.push(x.Down)}),window.addEventListener("touchend",function(t){t.preventDefault(),t.stopPropagation(),t.changedTouches[0],n.inputs=[]})},Y);function Y(t){this.inputs=[],this.CanvasDOM=t,this.listen()}var W=new i(t,e,1080,720),V=0;!function t(e){var i=e-V;V=e,W.refresh(i),requestAnimationFrame(t)}(0)});